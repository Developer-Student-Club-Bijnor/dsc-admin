<strong>
    <h2 style="font-family:fantasy">Donate For Code</h2></strong>
<hr color=red height=20px/>
<div id="spinner" class="text-primary spinner-grow" role="status" style="margin-left:45%;width: 3rem; height: 3rem;">
    <span class="sr-only">Loading...</span>
</div>
<div class="row">
    <div class="col-lg-7">
        <h3>Send Interview Questions</h3>
        <hr>
        <form>
            <div class="form-group">
                <label for="res">Person</label>
                <select list="technology" class="form-control " id="res-text">
                    
                </select>
                <div class="invalid-feedback">
                    Please enter person name
                </div>
            </div><br>
            <hr><br>
            <div>
                <div>
                    <h4>Prepare Mail
                    </h4>

                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="text" class="form-control " id="email" />
                        <div class="invalid-feedback">
                            Please enter email
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <input type="text" class="form-control " id="subject" />
                        <div class="invalid-feedback">
                            Please enter subject
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="questions">Questions</label>
                        <textarea type="text" class="form-control " id="questions"></textarea>
                        <div class="invalid-feedback">
                            Please enter questions
                        </div>
                    </div>
                </div> <br>

                <div class="form-group ">
                    <button type="button" class="btn btn-primary" id="send-mail">Send</button>
                </div>
            </div>
        </form>
    </div>
    <div class="col-lg-12">
        <div>
            <h3>Donation Details</h3>
            <hr>
            <label for="res-text">Person</label>
            <select placeholder="Select from list only" list="technology" class="form-control " id="re-text"></select>
            <div class="invalid-feedback">
                Please select any person
            </div>
        </div>
        <div>
            <br>
            <button id="train-export" type="button">Export Excel</button>
            <br>
            <br>
            <table id="export-train" class="table table-striped">
                <thead>
                    <td>Amount</td>
                    <td>Date</td>
                    <td>Appr. ID</td>
                    <td>Ref. ID</td>
                    <td>Trans. ID</td>
                    <td>Mail</td>
                    <td>Status</td>

                </thead>
                <tbody id="train-res">

                </tbody>
            </table>
        </div>

    </div>
</div>
</div>

<script>
    var li = firebase.database().ref("Donation/");

    li.on("value", function(tra) {
        if (tra.exists()) {

            var resOption = "";

            var perOption = "";

            tra.forEach(function(get) {
                var user = get.key;



                var use = firebase.database().ref("Users/" + user + "/");
                use.on("value", function(gets) {
                    var name = gets.val().displayName;
                    var email = gets.val().email;
                    var trainKey = use.key;
                    resOption += "<option value='";
                    resOption += trainKey;
                    resOption += "'>";
                    resOption += name;
                    perOption += "</option>";
                    perOption += "<option value='";
                    perOption += email;
                    perOption += "'>";
                    perOption += name;
                    perOption += "</option>";
                    $("#email").val(email);

                })
            })
            $("#re-text").html(resOption);
            $("#res-text").html(perOption);
            $("#spinner").removeClass("spinner-grow");

        }
    })

    $("#re-text").addClass("is-invalid");
    var value = document.getElementById("re-text");
    var uid = "";

    value.addEventListener("input", function() {
        uid = this.value;
        $("#train-res").html("");
        $("#spinner").addClass("spinner-grow");
        $("#re-text").removeClass("is-invalid");
        var dres = firebase.database().ref("Donation" + uid + "/");

        if (!uid) {
            $("#train-res").html("");
            $("#re-text").addClass("is-invalid");
            $("#spinner").removeClass("spinner-grow");
            return;
        } else {
            dres.on("value", function(gets) {
                if (gets.exists()) {
                    var resHtml = "";
                    gets.forEach(function(data) {
                        data.forEach(function(re) {
                            var check = re.val().mail_sent;

                            var str = "";
                            if (check == 0)
                                str += "Pending";
                            else
                                str += "Delivered";
                            resHtml += "<tr>";
                            resHtml += "<td>";
                            resHtml += re.val().payment;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += re.val().date;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += re.val().approval;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += re.val().rID;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += re.val().tID;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += str;
                            resHtml += "</td>";
                            resHtml += "<td>";
                            resHtml += re.val().status;
                            resHtml += "</td>";
                            resHtml += "</tr>";
                        })
                        $("#train-res").html(resHtml);
                        $("#spinner").removeClass("spinner-grow");

                    })

                } else {
                    $("#train-res").html("");
                    $("#spinner").removeClass("spinner-grow");
                }
            })

        }

    })



    var sel = document.getElementById('re-text');
    uid = sel.value;
    var dres = firebase.database().ref("Donation/" + uid + "/");
    dres.on("value", function(gets) {
        if (gets.exists()) {
            var resHtml = "";
            $("#re-text").removeClass("is-invalid");
            gets.forEach(function(re) {
                var check = re.val().mail_sent;
                console.log(check);
                var str = "";
                if (check == 0)
                    str += "Pending";
                else
                    str += "Delivered";
                resHtml += "<tr>";
                resHtml += "<td> â‚¹ ";
                resHtml += re.val().payment;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().date;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().approval;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().rID;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().tID;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += str;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().status;
                resHtml += "</td>";
                resHtml += "</tr>";
            })
            $("#train-res").html(resHtml);
            $("#spinner").removeClass("spinner-grow");

        } else {
            $("#train-res").html("");
            $("#spinner").removeClass("spinner-grow");
        }
    })

    var sele = document.getElementById('res-text');
    var email = "";


    sele.addEventListener("input", function() {
        email = this.value;

        $("#email").val(email);

    });






    $("#train-export").click(function() {
        $("#export-train").table2excel({
            filename: uid + " (PersonID) .xls"
        });
    })
</script>
<script src="send-email.js">
</script>