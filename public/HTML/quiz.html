<strong>
    <h2 style="font-family:fantasy">Quiz</h2></strong>
<hr color=red height=20px/>
<div id="spinner" class="text-primary spinner-grow" role="status" style="margin-left:45%;width: 3rem; height: 3rem;">
    <span class="sr-only">Loading...</span>
</div>
<section id="edit_section"></section>
<h3>Add Questions</h3>
<br>



<div class="row">

    <div class="col-lg-5" style="margin-left:5%;margin-top:10%">
        <label for="quiz-name">Category</label>
        <select list="quiz" class="form-control " id="quiz-name">

            </select>
        <div class="invalid-feedback">
            Please choose a category
        </div>

    </div>
    <hr>
    <div class="col-lg-4">
        <form id="quizy">
            <div class="form-group">
                <label for="quiz-question">Question</label>
                <input type="text" class="form-control " id="quiz-question" />
                <div class="invalid-feedback">
                    Please enter a question
                </div>
            </div>
            <div class="form-group">
                <label for="quiz-a">Option A</label>
                <input type="text" class="form-control " id="quiz-a" />
                <div class="invalid-feedback">
                    Please enter option
                </div>
            </div>
            <div class="form-group">
                <label for="quiz-b">Option B</label>
                <input type="text" class="form-control " id="quiz-b" />
                <div class="invalid-feedback">
                    Please enter option
                </div>
            </div>
            <div class="form-group">
                <label for="quiz-c">Option C</label>
                <input type="text" class="form-control " id="quiz-c" />
                <div class="invalid-feedback">
                    Please enter option
                </div>
            </div>
            <div class="form-group">
                <label for="quiz-d">Option D</label>
                <input type="text" class="form-control " id="quiz-d" />
                <div class="invalid-feedback">
                    Please enter option
                </div>
            </div>
            <div class="form-group">
                <label for="quiz-correct">Correct Answer</label>
                <input type="text" class="form-control " id="quiz-correct" />
                <div class="invalid-feedback">
                    Please enter correct option
                </div>
            </div>
            <div class="form-group">
                <button id="quiz-upload" type="button " class="btn btn-primary ">Add Question</button>
            </div>
            <div id="result-quiz">
                <h6></h6>
            </div>

        </form>

    </div>
    <div id="id01" class="del" style="display: none;">

        <form class="model-content">
            <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
            <div class="container">
                <h1>Delete Question</h1>
                <p>It will delete question and remove it from app. Are your sure want to delete this question ?</p>

                <div class="clearfix">
                    <button type="button" id="cancel-btn" class="cancelbtn">Cancel</button>
                    <button type="button" id="delete-btn" class="deletebtn">Delete</button>
                </div>
            </div>
        </form>
    </div>

    <hr><br>
    <br>
    <div class="col-lg-12">
        <div>
            <h3>Question Bank</h3>
            <br>
            <label for="res-text">Technology/Language</label>
            <select placeholder="Select from list only" list="technology" class="form-control" id="re-text">
                </select>
            <div class="invalid-feedback">
                Please select any training
            </div>


        </div>
        <div>
            <br>
            <button type="button">Export Excel</button>
            <br>
            <br>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <td>Question</td>

                        <td>Option A</td>
                        <td>
                            Option B</td>
                        <td>Option C</td>
                        <td>Option D</td>
                        <td>Correct Answer</td>
                        <td>Remove
                        </td>
                        <td>Edit
                        </td>
                    </tr>

                </thead>

                <tbody id="res-q">
                </tbody>


            </table>

        </div>


    </div>
</div>

<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span style="margin-left:98%;margin-bottom:10px" onclick="closeBox()" id="close" class="close">&times;</span>

        <div class="card">
            <div class="card-header card-header-primary">
                <h4 class="card-title" id="add-product-id">Edit Question</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="form-group">
                        <label class="bmd-label-floating">Technology/Language</label>
                        <select id="category_id" class="form-control">
                                 </select>
                    </div>

                </div>
                <div class="row">
                    <label for="quiz-questione">Question</label>
                    <input type="text" class="form-control " id="quiz-questione" />
                    <div class="invalid-feedback">
                        Please enter a question
                    </div>
                </div>
                <div class="row">
                    <label for="quiz-ae">Option A</label>
                    <input type="text" class="form-control " id="quiz-ae" />
                    <div class="invalid-feedback">
                        Please enter option
                    </div>
                </div>
                <div class="row">
                    <label for="quiz-be">Option B</label>
                    <input type="text" class="form-control " id="quiz-be" />
                    <div class="invalid-feedback">
                        Please enter option
                    </div>
                </div>
                <div class="row">
                    <label for="quiz-ce">Option C</label>
                    <input type="text" class="form-control " id="quiz-ce" />
                    <div class="invalid-feedback">
                        Please enter option
                    </div>
                </div>
                <div class="row">
                    <label for="quiz-de">Option D</label>
                    <input type="text" class="form-control " id="quiz-de" />
                    <div class="invalid-feedback">
                        Please enter option
                    </div>
                </div>
                <div class="row">
                    <label for="quiz-correcte">Correct Answer</label>
                    <input type="text" class="form-control " id="quiz-correcte" />
                    <div class="invalid-feedback">
                        Please enter correct option
                    </div>
                </div>

                <button id="edit-question" style="color: white;margin-top:10px" type="submit" class="btn btn-primary pull-center">Save</button>
                <button id="close" onclick="closeBox()" style="color: white;margin-top:10px" type="close" class="btn btn-primary">Cancel</button>
                <div class="form-group" style="margin-top: 10px;">
                    <div class="progress">
                        <div id="cat-progresse" class="progress-bar" style="width:0%">0%</div>
                    </div>
                </div>
                <div id="result-cate">
                    <h6></h6>
                </div>

            </div>
        </div>
    </div>

</div>


<style>
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
        /* Black w/ opacity */
    }
    /* Modal Content/Box */
    
    .modal-content {
        background-color: #fefefe;
        margin: 0% auto;
        /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 40%;
        /* Could be more or less, depending on screen size */
    }
    
    .model-content {
        background-color: #fefefe;
        margin: 0% auto;
        /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 50%;
        margin-top: 12%;
        margin-left: 30%;
    }
    /* The Close Button */
    
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    
    .cancelbtn {
        color: gray;
    }
    
    .deletebtn {
        color: green;
    }
    
    .del {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        left: 0;
        top: 0;
        width: 100%;
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.4);
    }
</style>

<script>
    var addC = document.getElementById("myModal");
    var value = document.getElementById("quiz-name");
    var tech = "";
    value.addEventListener("input", function() {
        tech = this.value;
        if (!tech) {
            $("#quiz-name").addClass("is-invalid");
            $("#result-quiz").removeClass("alert alert-success");
            $("#result-quiz").html("");
            return;
        } else {
            $("#quiz-name").removeClass("is-invalid");
            var technology = tech.toLowerCase().replace(" ", "").replace("#", "sharp").replace("++", "plusplus");

            $("#quiz-upload").click(function() {

                var techie = $("#quiz-name").val();
                if (!techie) {

                    $("#quiz-name").addClass("is-invalid");
                    window.alert("Please select technology");
                    return;

                }
                $("#quiz-question").removeClass("is-invalid");
                $("#quiz-a").removeClass("is-invalid");
                $("#quiz-b").removeClass("is-invalid");
                $("quiz-c").removeClass("is-invalid");
                $("#quiz-d").removeClass("is-invalid");
                $("#quiz-correct").removeClass("is-invalid");




                var question = $("#quiz-question").val();
                var a = $("#quiz-a").val();
                var b = $("#quiz-b").val();
                var c = $("#quiz-c").val();
                var d = $("#quiz-d").val();
                var correct = $("#quiz-correct").val();

                if (!question) {
                    $("quiz-question").addClass("is-invalid");
                    return;
                }
                if (!a) {
                    $("quiz-a").addClass("is-invalid");
                    return;
                }
                if (!b) {
                    $("quiz-b").addClass("is-invalid");
                    return;
                }
                if (!c) {
                    $("quiz-c").addClass("is-invalid");
                    return;
                }
                if (!d) {
                    $("quiz-d").addClass("is-invalid");
                    return;
                }
                if (!correct) {
                    $("quiz-correct").addClass("is-invalid");
                    return;
                }


                $("#spinner").addClass("spinner-grow");

                var quizData = {
                    "question": question,
                    "option1": a,
                    "option2": b,
                    "option3": c,
                    "option4": d,
                    "correct_answer": correct


                };

                var data = firebase.database().ref("QuizData/QA/" + technology);
                data.push().set(quizData, function(err) {
                    if (err) {
                        $("#result-quiz").attr("class", "alert alert-danger");
                        $("#result-quiz").html(err.message);

                    } else {
                        $("#result-quiz").attr("class", "alert alert-success");
                        $("#result-quiz").html("Question Added Successfully");


                    }

                    $("#spinner").removeClass("spinner-grow")
                    $("#quizy")[0].reset();
                    $("#quiz-name").val("");
                    $("#quiz-question").val("");
                    $("#quiz-a").val("");
                    $("#quiz-b").val("");
                    $("#quiz-c").val("");
                    $("#quiz-d").val("");
                    $("#quiz-correct").val("");
                    $("#res-q").html("");


                })
            })
        }
    });

    var li = firebase.database().ref("QuizData/Category/");

    li.on("value", function(tra) {
        if (tra.exists()) {
            var resOption = "";

            tra.forEach(function(get) {

                resOption += "<option>";
                resOption += get.val().category;
                resOption += "</option>";
            })
            $("#re-text").html(resOption);
            $("#quiz-name").html(resOption);
            $("#category_id").html(resOption);
            $("#spinner").removeClass("spinner-grow");

        }
    })


    var val = document.getElementById("re-text");
    var question = "";

    val.addEventListener("input", function() {
        question = this.value;
        $("#res-q").html("");
        var technology = question.toLowerCase().replace(" ", "").replace("#", "sharp").replace("++", "plusplus");

        $("#spinner").addClass("spinner-grow");
        $("#re-text").removeClass("is-invalid");
        var dres = firebase.database().ref("QuizData/QA/" + technology + "/");

        if (!technology) {
            $("#re-text").addClass("is-invalid");
            $("#res-q").html("");
            $("#spinner").removeClass("spinner-grow");

            return;
        } else {
            dres.on("value", function(gets) {
                if (gets.exists()) {
                    var resHtml = "";

                    gets.forEach(function(re) {

                        var qid = "&#39;" + re.key + "&#39;";
                        var tech = "&#39;" + technology + "&#39;";
                        var teche = "&#39;" + question + "&#39;";


                        resHtml += "<tr>";
                        resHtml += "<td>";
                        resHtml += re.val().question;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += re.val().option1;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += re.val().option2;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += re.val().option3;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += re.val().option4;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += re.val().correct_answer;
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += "<button id='remove' type='button' placeholder='Remove' class='btn btn-primary' onclick='funRemove(" + tech + "," + qid + ")'>Remove</button>";
                        resHtml += "</td>";
                        resHtml += "<td>";
                        resHtml += "<a href='#edit_section'><button id='edit' type='button' placeholder='Edit' class='btn btn-primary' onclick='funEdit(" + teche + "," + qid + ")'>Edit</button></a>";
                        resHtml += "</td>";
                        resHtml += "</tr>";
                    })
                    $("#res-q").html(resHtml);
                    $("#spinner").removeClass("spinner-grow");
                } else {
                    $("#res-q").html("");
                    $("#spinner").removeClass("spinner-grow");
                }
            })

        }

    })

    question = $("re-text").val();
    var technology = question.toLowerCase().replace(" ", "").replace("#", "sharp").replace("++", "plusplus");

    var dres = firebase.database().ref("QuizData/QA/" + technology + "/");

    dres.on("value", function(gets) {
        if (gets.exists()) {
            var resHtml = "";
            $("#re-text").removeClass("is-invalid");
            gets.forEach(function(re) {

                var qid = "&#39;" + re.key + "&#39;";
                var tech = "&#39;" + technology + "&#39;";
                var teche = "&#39;" + question + "&#39;";


                resHtml += "<tr>";
                resHtml += "<td>";
                resHtml += re.val().question;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().option1;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().option2;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().option3;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().option4;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += re.val().correct_answer;
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += "<button id='remove' type='button' placeholder='Remove' class='btn btn-primary' onclick='funRemove(" + tech + "," + qid + ")'>Remove</button>";
                resHtml += "</td>";
                resHtml += "<td>";
                resHtml += "<a href='#edit_section'><button id='edit' type='button' placeholder='Edit' class='btn btn-primary' onclick='funEdit(" + teche + "," + qid + ")'>Edit</button></a>";
                resHtml += "</td>";
                resHtml += "</tr>";
            })
            $("#res-q").html(resHtml);
            $("#spinner").removeClass("spinner-grow");
        } else {
            $("#res-q").html("");
            $("#spinner").removeClass("spinner-grow");
        }
    })

    function funRemove(tech, qid) {

        document.getElementById('id01').style.display = 'block';
        $("#delete-btn").click(function() {
            var dres = firebase.database().ref("QuizData/QA/" + tech + "/" + qid);
            var question;
            dres.on("value", function(cats) {
                question = cats.val().question;
            });
            dres.remove();
            window.alert("Question is deleted from Question Bank and removed from app! You cannot recover that question. Deleted Question : " + question);
            document.getElementById('id01').style.display = 'none';
        })



        $("#cancel-btn").click(function() {
            document.getElementById("id01").style.display = 'none';
        })
    }


    window.onclick = function(event) {
        if (event.target == addC) {
            addC.style.display = "none";
            $("#category_id").val('');
            $("#quiz-questione").val('');
            $("#quiz-ae").val('');
            $("#quiz-be").val('');
            $("#quiz-ce").val('');
            $("#quiz-de").val('');
            $("#quiz-correcte").val('');
            $("#result-cate").val('');
            $("#cat-progresse").val('');
        }

    }

    function closeBox() {

        addC.style.display = "none";

        $("#category_id").val('');
        $("#quiz-questione").val('');
        $("#quiz-ae").val('');
        $("#quiz-be").val('');
        $("#quiz-ce").val('');
        $("#quiz-de").val('');
        $("#quiz-correcte").val('');
        $("#result-cate").val('');
        $("#cat-progresse").val('');
    }

    function funEdit(tech, qid) {

        addC.style.display = "block";
        $("#cat-progresse").html(" ");
        $("#cat-progresse").attr("style", "width:" + "0" + "%");
        $("#result-cate").html(" ");

        var technology = tech.toLowerCase().replace(" ", "").replace("#", "sharp").replace("++", "plusplus");
        var dres = firebase.database().ref("QuizData/QA/" + technology + "/" + qid);
        var question;
        var optionA;
        var optionB;
        var optionC;
        var optionD;
        var correctAnswer;


        dres.on("value", function(get) {
            question = get.val().question;
            optionA = get.val().option1;
            optionB = get.val().option2;
            optionC = get.val().option3;
            optionD = get.val().option4;
            correctAnswer = get.val().correct_answer;

        })

        $("#category_id").val(tech);
        $("#quiz-questione").val(question);
        $("#quiz-ae").val(optionA);
        $("#quiz-be").val(optionB);
        $("#quiz-ce").val(optionC);
        $("#quiz-de").val(optionD);
        $("#quiz-correcte").val(correctAnswer);

        $("#edit-question").one('click', function() {

            var techie = $("#category_id").val();
            if (!techie) {

                $("#category_id").addClass("is-invalid");
                window.alert("Please select technology");
                return;

            }
            $("#quiz-questione").removeClass("is-invalid");
            $("#quiz-ae").removeClass("is-invalid");
            $("#quiz-be").removeClass("is-invalid");
            $("quiz-ce").removeClass("is-invalid");
            $("#quiz-de").removeClass("is-invalid");
            $("#quiz-correcte").removeClass("is-invalid");




            var question = $("#quiz-questione").val();
            var a = $("#quiz-ae").val();
            var b = $("#quiz-be").val();
            var c = $("#quiz-ce").val();
            var d = $("#quiz-de").val();
            var correct = $("#quiz-correcte").val();

            if (!question) {
                $("quiz-questione").addClass("is-invalid");
                return;
            }
            if (!a) {
                $("quiz-ae").addClass("is-invalid");
                return;
            }
            if (!b) {
                $("quiz-be").addClass("is-invalid");
                return;
            }
            if (!c) {
                $("quiz-ce").addClass("is-invalid");
                return;
            }
            if (!d) {
                $("quiz-de").addClass("is-invalid");
                return;
            }
            if (!correct) {
                $("quiz-correcte").addClass("is-invalid");
                return;
            }

            var quizData = {
                "question": question,
                "option1": a,
                "option2": b,
                "option3": c,
                "option4": d,
                "correct_answer": correct

            };

            dres.set(quizData, function(err) {
                if (err) {
                    $("#result-cate").attr("class", "alert alert-danger");
                    $("#result-cate").html(err.message);

                } else {
                    $("#result-cate").attr("class", "alert alert-success");
                    $("#result-cate").html("Question Edited Successfully");


                }

                $("#category_id").val("");
                $("#quiz-questione").val("");
                $("#quiz-ae").val("");
                $("#quiz-be").val("");
                $("#quiz-ce").val("");
                $("#quiz-de").val("");
                $("#quiz-correcte").val("");
                $("#cat-progresse").html("Completed");
                $("#cat-progresse").attr("style", "width:" + "100" + "%");



            })
        })




    }
</script>